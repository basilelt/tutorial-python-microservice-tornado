post-get-test_production:
  stage: app-test
  image: curlimages/curl:8.12.1
  variables:
    URL: http://$KUBE_DOMAIN
  rules:
    - if: '$CI_COMMIT_TAG'
  before_script:
    - chmod +x .gitlab/scripts/api-test.sh
  script:
    - .gitlab/scripts/api-test.sh $URL data/addresses/namo.json
  environment:
    name: production

post-get-test:
  stage: app-test
  image: curlimages/curl:8.12.1
  variables:
    URL: http://$CI_ENVIRONMENT_SLUG.$KUBE_DOMAIN
  rules:
    - if: '$CI_COMMIT_BRANCH == "develop"'
      variables:
        ENVIRONMENT: integration
    - if: '$CI_COMMIT_BRANCH == "master"'
      variables:
        ENVIRONMENT: preproduction
  before_script:
    - chmod +x .gitlab/scripts/api-test.sh
  script:
    - .gitlab/scripts/api-test.sh $URL data/addresses/namo.json
  environment:
    name: $ENVIRONMENT

post-get-test_review:
  stage: app-test
  image: curlimages/curl:8.12.1
  variables:
    URL: http://$CI_COMMIT_REF_SLUG.$KUBE_DOMAIN
  rules:
    - if: '$CI_COMMIT_BRANCH =~ /^feat-/'
  before_script:
    - chmod +x .gitlab/scripts/api-test.sh
  script:
    - .gitlab/scripts/api-test.sh $URL data/addresses/raga.json
  environment:
    name: review/$CI_COMMIT_REF_SLUG
